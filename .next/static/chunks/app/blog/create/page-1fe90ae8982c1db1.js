(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[316],{63:(e,t,r)=>{"use strict";var l=r(7260);r.o(l,"useRouter")&&r.d(t,{useRouter:function(){return l.useRouter}})},789:(e,t,r)=>{Promise.resolve().then(r.bind(r,5956))},3011:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return n}});let l=r(2115);function n(e,t){let r=(0,l.useRef)(null),n=(0,l.useRef)(null);return(0,l.useCallback)(l=>{if(null===l){let e=r.current;e&&(r.current=null,e());let t=n.current;t&&(n.current=null,t())}else e&&(r.current=a(e,l)),t&&(n.current=a(t,l))},[e,t])}function a(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},4652:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return o},getImageProps:function(){return u}});let l=r(8140),n=r(5040),a=r(1356),s=l._(r(1124));function u(e){let{props:t}=(0,n.getImgProps)(e,{defaultLoader:s.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let o=a.Image},5239:(e,t,r)=>{"use strict";r.d(t,{default:()=>n.a});var l=r(4652),n=r.n(l)},5956:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var l=r(5155),n=r(2115),a=r(63),s=r(5239);function u(){let e=(0,a.useRouter)(),[t,r]=(0,n.useState)(""),[u,o]=(0,n.useState)(null),[i,c]=(0,n.useState)(null),[d,p]=(0,n.useState)(!1),[f,h]=(0,n.useState)(!1),[g,b]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{(await fetch("/api/me",{credentials:"include"})).ok?b(!0):(b(!1),e.push("/login"))}catch(t){b(!1),e.push("/login")}})()},[e]);let m=e=>{if(o(e),e){let t=new FileReader;t.onload=e=>{var t;c(null==(t=e.target)?void 0:t.result)},t.readAsDataURL(e)}else c(null)},x=(e,t)=>{e.preventDefault(),e.stopPropagation(),"in"===t&&h(!0),"out"===t&&h(!1),"drop"===t&&(h(!1),e.dataTransfer.files[0]&&m(e.dataTransfer.files[0]))},y=async r=>{r.preventDefault(),p(!0);try{let r=new FormData;r.append("caption",t),u&&r.append("image",u);let l=await fetch("/api/blog/create",{method:"POST",body:r,credentials:"include"});if(l.ok)e.push("/profile");else if(401===l.status)alert("Please login to continue."),e.push("/login");else{let e=await l.json().catch(()=>({error:"Unknown error"}));alert("Failed: ".concat(e.error))}}catch(e){alert("Network error. Try again.")}finally{p(!1)}};return null===g?(0,l.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gray-100",children:(0,l.jsx)("p",{children:"Checking authentication..."})}):g?(0,l.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,l.jsxs)("div",{className:"max-w-3xl mx-auto px-4 py-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-purple-600 mb-6",children:"Create New Post"}),(0,l.jsxs)("form",{onSubmit:y,className:"space-y-6",children:[(0,l.jsx)("div",{className:"border-2 border-dashed rounded-xl p-6 text-center transition ".concat(f?"border-purple-400 bg-purple-50":"border-gray-300"),onDragEnter:e=>x(e,"in"),onDragLeave:e=>x(e,"out"),onDragOver:e=>x(e,"over"),onDrop:e=>x(e,"drop"),children:i?(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(s.default,{src:i,alt:"Preview",width:800,height:600,className:"rounded-lg object-cover w-full max-h-80"}),(0,l.jsx)("button",{type:"button",onClick:()=>m(null),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-2",children:"\xd7"})]}):(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"mb-2",children:"Drag & drop an image, or"}),(0,l.jsxs)("label",{className:"cursor-pointer inline-block bg-purple-600 text-white px-4 py-2 rounded",children:["Choose Image",(0,l.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;return m((null==(t=e.target.files)?void 0:t[0])||null)}})]})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("textarea",{value:t,onChange:e=>r(e.target.value),rows:4,maxLength:500,placeholder:"Write your caption here...",className:"w-full border border-gray-300 rounded-xl p-4 resize-none"}),(0,l.jsxs)("p",{className:"text-sm text-gray-500 text-right",children:[t.length,"/500"]})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("button",{type:"button",onClick:()=>e.back(),className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-100",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",disabled:!u||!t.trim()||d,className:"px-6 py-2 rounded text-white transition ".concat(u&&t.trim()&&!d?"bg-purple-600 hover:bg-purple-700":"bg-gray-400 cursor-not-allowed"),children:d?"Publishing...":"Publish"})]})]})]})}):null}}},e=>{e.O(0,[356,441,493,358],()=>e(e.s=789)),_N_E=e.O()}]);