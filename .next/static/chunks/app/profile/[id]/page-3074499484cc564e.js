(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[870],{63:(e,s,t)=>{"use strict";var o=t(7260);t.o(o,"useRouter")&&t.d(s,{useRouter:function(){return o.useRouter}})},1503:(e,s,t)=>{"use strict";t.d(s,{default:()=>l});var o=t(5155),n=t(2115),r=t(63);function l(e){let{blogId:s,initialLiked:t=!1,initialCount:l=0,userId:i,onLikeChange:a}=e,c=(0,r.useRouter)(),[u,d]=(0,n.useState)(t),[h,g]=(0,n.useState)(l),[f,p]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/me",{method:"GET",credentials:"include"});if(!e.ok){console.log("Kh\xf4ng c\xf3 session, chuyển hướng đến /login"),x(!1);return}let s=await e.json();console.log("User session found:",s),x(!0)}catch(e){console.error("Lỗi kiểm tra session:",e),x(!1)}})()},[]);let k=async()=>{if(null===m)return void console.log("Đang kiểm tra session...");if(!m){console.log("Kh\xf4ng c\xf3 session, chuyển hướng đến /login"),c.push("/login");return}p(!0);try{console.log("Sending like request for blog:",s);let e=await fetch("/api/blog/".concat(s,"/like"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(console.log("Response status:",e.status),!e.ok){let s=await e.text();throw console.error("Server error:",s),Error("HTTP ".concat(e.status,": ").concat(s))}let t=await e.json();console.log("Like response:",t),d(t.liked);let o=t.liked?h+1:h-1;g(o),a&&a(o)}catch(e){console.error("Like error:",e),e instanceof Error&&e.message.includes("401")&&(console.log("Session invalid, redirecting to login"),c.push("/login"))}finally{p(!1)}};return(0,o.jsxs)("button",{onClick:k,disabled:f||null===m,className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors flex-1 justify-center ".concat(f||null===m?"opacity-50 cursor-not-allowed":"hover:bg-gray-100"),children:[(0,o.jsx)("span",{className:u?"text-blue-500":"text-gray-600",children:"\uD83D\uDC4D"}),(0,o.jsx)("span",{className:"font-medium ".concat(u?"text-blue-600":"text-gray-600"),children:f?"Đang xử l\xfd...":u?"Đ\xe3 th\xedch":"Th\xedch"}),h>0&&(0,o.jsxs)("span",{className:"text-sm text-gray-500",children:["(",h,")"]})]})}},5555:(e,s,t)=>{Promise.resolve().then(t.bind(t,1503)),Promise.resolve().then(t.t.bind(t,2619,23)),Promise.resolve().then(t.t.bind(t,1356,23))}},e=>{e.O(0,[619,356,441,493,358],()=>e(e.s=5555)),_N_E=e.O()}]);