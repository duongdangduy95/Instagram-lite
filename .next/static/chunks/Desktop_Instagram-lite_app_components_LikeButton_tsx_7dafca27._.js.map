{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/Instagram-lite/app/components/LikeButton.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\n\r\ninterface LikeButtonProps {\r\n  blogId: string\r\n  initialLiked?: boolean\r\n  initialCount?: number\r\n  userId?: string | null\r\n  onLikeChange?: (newCount: number) => void\r\n  onRefetch?: () => void\r\n}\r\n\r\nexport default function LikeButton({ \r\n  blogId, \r\n  initialLiked = false, \r\n  initialCount = 0,\r\n  userId,\r\n  onLikeChange,\r\n  onRefetch\r\n}: LikeButtonProps) {\r\n  const router = useRouter()\r\n  const [liked, setLiked] = useState(initialLiked)\r\n  const [likeCount, setLikeCount] = useState(initialCount)\r\n  const [loading, setLoading] = useState(false)\r\n  const [authenticated, setAuthenticated] = useState<boolean | null>(null)\r\n\r\n  // ‚úÖ Ki·ªÉm tra session b·∫±ng c√°ch g·ªçi API /api/me\r\n  useEffect(() => {\r\n    const checkSession = async () => {\r\n      try {\r\n        const res = await fetch('/api/me', {\r\n          method: 'GET',\r\n          credentials: 'include',\r\n        })\r\n\r\n        if (!res.ok) {\r\n          setAuthenticated(false)\r\n          return\r\n        }\r\n\r\n        const data = await res.json()\r\n        setAuthenticated(true)\r\n      } catch (err) {\r\n        setAuthenticated(false)\r\n      }\r\n    }\r\n\r\n    checkSession()\r\n  }, [])\r\n\r\n  const handleLike = async () => {\r\n    if (authenticated === null) {\r\n      return\r\n    }\r\n\r\n    if (!authenticated) {\r\n      router.push('/login')\r\n      return\r\n    }\r\n\r\n    setLoading(true)\r\n\r\n    try {\r\n      const response = await fetch(`/api/blog/${blogId}/like`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.text()\r\n        throw new Error(`HTTP ${response.status}: ${errorData}`)\r\n      }\r\n\r\n      const data = await response.json()\r\n      setLiked(data.liked)\r\n      const newCount = data.liked ? likeCount + 1 : likeCount - 1\r\n      setLikeCount(newCount)\r\n      \r\n      // G·ªçi callback ƒë·ªÉ update parent component\r\n      if (onLikeChange) {\r\n        onLikeChange(newCount)\r\n      }\r\n\r\n      // Refetch data ƒë·ªÉ sync v·ªõi server\r\n      if (onRefetch) {\r\n        setTimeout(onRefetch, 100)\r\n      }\r\n    } catch (error) {\r\n      if (error instanceof Error && error.message.includes('401')) {\r\n        router.push('/login')\r\n      }\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <button\r\n      onClick={handleLike}\r\n      disabled={loading || authenticated === null}\r\n      className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors flex-1 justify-center ${\r\n        loading || authenticated === null\r\n          ? 'opacity-50 cursor-not-allowed'\r\n          : 'hover:bg-gray-100'\r\n      }`}\r\n    >\r\n      <span className={liked ? 'text-blue-500' : 'text-gray-600'}>\r\n        üëç\r\n      </span>\r\n      <span className={`font-medium ${liked ? 'text-blue-600' : 'text-gray-600'}`}>\r\n        {loading ? 'ƒêang x·ª≠ l√Ω...' : liked ? 'ƒê√£ th√≠ch' : 'Th√≠ch'}\r\n      </span>\r\n      {likeCount > 0 && (\r\n        <span className=\"text-sm text-gray-500\">({likeCount})</span>\r\n      )}\r\n    </button>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAce,SAAS,WAAW,KAOjB;QAPiB,EACjC,MAAM,EACN,eAAe,KAAK,EACpB,eAAe,CAAC,EAChB,MAAM,EACN,YAAY,EACZ,SAAS,EACO,GAPiB;;IAQjC,MAAM,SAAS,IAAA,kLAAS;IACxB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yMAAQ,EAAC;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yMAAQ,EAAC;IAC3C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yMAAQ,EAAC;IACvC,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yMAAQ,EAAiB;IAEnE,+CAA+C;IAC/C,IAAA,0MAAS;gCAAC;YACR,MAAM;qDAAe;oBACnB,IAAI;wBACF,MAAM,MAAM,MAAM,MAAM,WAAW;4BACjC,QAAQ;4BACR,aAAa;wBACf;wBAEA,IAAI,CAAC,IAAI,EAAE,EAAE;4BACX,iBAAiB;4BACjB;wBACF;wBAEA,MAAM,OAAO,MAAM,IAAI,IAAI;wBAC3B,iBAAiB;oBACnB,EAAE,OAAO,KAAK;wBACZ,iBAAiB;oBACnB;gBACF;;YAEA;QACF;+BAAG,EAAE;IAEL,MAAM,aAAa;QACjB,IAAI,kBAAkB,MAAM;YAC1B;QACF;QAEA,IAAI,CAAC,eAAe;YAClB,OAAO,IAAI,CAAC;YACZ;QACF;QAEA,WAAW;QAEX,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,AAAC,aAAmB,OAAP,QAAO,UAAQ;gBACvD,QAAQ;gBACR,SAAS;oBACP,gBAAgB;gBAClB;gBACA,aAAa;YACf;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,YAAY,MAAM,SAAS,IAAI;gBACrC,MAAM,IAAI,MAAM,AAAC,QAA2B,OAApB,SAAS,MAAM,EAAC,MAAc,OAAV;YAC9C;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,SAAS,KAAK,KAAK;YACnB,MAAM,WAAW,KAAK,KAAK,GAAG,YAAY,IAAI,YAAY;YAC1D,aAAa;YAEb,0CAA0C;YAC1C,IAAI,cAAc;gBAChB,aAAa;YACf;YAEA,kCAAkC;YAClC,IAAI,WAAW;gBACb,WAAW,WAAW;YACxB;QACF,EAAE,OAAO,OAAO;YACd,IAAI,iBAAiB,SAAS,MAAM,OAAO,CAAC,QAAQ,CAAC,QAAQ;gBAC3D,OAAO,IAAI,CAAC;YACd;QACF,SAAU;YACR,WAAW;QACb;IACF;IAEA,qBACE,6NAAC;QACC,SAAS;QACT,UAAU,WAAW,kBAAkB;QACvC,WAAW,AAAC,4FAIX,OAHC,WAAW,kBAAkB,OACzB,kCACA;;0BAGN,6NAAC;gBAAK,WAAW,QAAQ,kBAAkB;0BAAiB;;;;;;0BAG5D,6NAAC;gBAAK,WAAW,AAAC,eAAwD,OAA1C,QAAQ,kBAAkB;0BACvD,UAAU,kBAAkB,QAAQ,aAAa;;;;;;YAEnD,YAAY,mBACX,6NAAC;gBAAK,WAAU;;oBAAwB;oBAAE;oBAAU;;;;;;;;;;;;;AAI5D;GA5GwB;;QAQP,kLAAS;;;KARF","debugId":null}}]
}